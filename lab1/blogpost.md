# Processing the GDELT dataset on AWS
In this blog post we will evaluate the GDELT dataset on AWS elastic mapReduce (EMR). The goal is to process the dataset consisting of 157378 segments on 20 `c4.8xlarge` core nodes in under 30 minutes.

## Tweaking the code to run on AWS
- Move .jar and segments to s3
- Remove .master('local') from code
- Change paths to s3
- Option to read segments directly form GDELT s3

## Test run 100 segments
After adapting our code, a test run was done on 100 segments using 3 `m4.large` machines (master and 2 nodes). The step in EMR processing the 100 segments took 2 minutes to run. The resulting .json file can be seen below.

```
{"date":"2015-02-20","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":1975},{"topic":"Islamic State","count":1958},{"topic":"New York","count":1395},{"topic":"Cyclone Marcia","count":935},{"topic":"Los Angeles","count":823},{"topic":"United Kingdom","count":775},{"topic":"White House","count":713},{"topic":"Associated Press","count":702},{"topic":"Practice Wrestling Room","count":630},{"topic":"Softball Spring Practice Varsity","count":558}]}

{"date":"2015-02-19","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":20335},{"topic":"Islamic State","count":15411},{"topic":"New York","count":13131},{"topic":"United Kingdom","count":12926},{"topic":"White House","count":8622},{"topic":"Los Angeles","count":7125},{"topic":"Practice Wrestling Room","count":5810},{"topic":"Associated Press","count":5744},{"topic":"New Zealand","count":5509},{"topic":"Softball Spring Practice Varsity","count":5173}]}

{"date":"2015-02-18","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"Islamic State","count":1787},{"topic":"United States","count":1210},{"topic":"New York","count":727},{"topic":"White House","count":489},{"topic":"Los Angeles","count":424},{"topic":"Associated Press","count":385},{"topic":"New Zealand","count":353},{"topic":"United Kingdom","count":325},{"topic":"Jeb Bush","count":298},{"topic":"Practice Wrestling Room","count":280}]}
```

From this .json file it can be seen that all the segments of 19-02-2015 have been processed, while this is probably not the case for 18-02 and 20-02 since these counts are lower.

This was a preliminary test and it is now time to see how we perform on more segments.

## Processing 1000 segments

```
{"date":"2015-02-25","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":24353},{"topic":"United Kingdom","count":15669},{"topic":"New York","count":14434},{"topic":"Islamic State","count":13650},{"topic":"White House","count":8128},{"topic":"Los Angeles","count":6486},{"topic":"New Zealand","count":6325},{"topic":"Practice Wrestling Room","count":6303},{"topic":"Homeland Security","count":5719},{"topic":"Softball Spring Practice Varsity","count":5543}]}
{"date":"2015-03-01","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":4579},{"topic":"New York","count":3059},{"topic":"Practice Wrestling Room","count":2944},{"topic":"Softball Spring Practice Varsity","count":2530},{"topic":"United Kingdom","count":2463},{"topic":"Islamic State","count":2289},{"topic":"National Weather Service","count":1977},{"topic":"Sri Lanka","count":1623},{"topic":"Sydney Morning","count":1539},{"topic":"White House","count":1475}]}
{"date":"2015-02-28","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":12591},{"topic":"Islamic State","count":9276},{"topic":"New York","count":9068},{"topic":"Homeland Security","count":6107},{"topic":"New Zealand","count":5966},{"topic":"Boris Nemtsov","count":5910},{"topic":"Practice Wrestling Room","count":5722},{"topic":"United Kingdom","count":5514},{"topic":"White House","count":5077},{"topic":"Softball Spring Practice Varsity","count":4921}]}
{"date":"2015-02-20","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":19556},{"topic":"New York","count":15151},{"topic":"Islamic State","count":12975},{"topic":"United Kingdom","count":12135},{"topic":"Los Angeles","count":8387},{"topic":"White House","count":8286},{"topic":"Practice Wrestling Room","count":6588},{"topic":"Softball Spring Practice Varsity","count":5828},{"topic":"Sydney Morning","count":5111},{"topic":"New Zealand","count":4785}]}
{"date":"2015-02-24","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":22268},{"topic":"New York","count":15315},{"topic":"United Kingdom","count":14653},{"topic":"Islamic State","count":14008},{"topic":"White House","count":8079},{"topic":"New Zealand","count":7824},{"topic":"Practice Wrestling Room","count":6465},{"topic":"Los Angeles","count":6321},{"topic":"Homeland Security","count":6179},{"topic":"World Cup","count":5874}]}
{"date":"2015-02-23","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":22936},{"topic":"United Kingdom","count":12915},{"topic":"Islamic State","count":12617},{"topic":"New York","count":12229},{"topic":"Academy Awards","count":11723},{"topic":"White House","count":8159},{"topic":"Practice Wrestling Room","count":6528},{"topic":"Los Angeles","count":5843},{"topic":"Softball Spring Practice Varsity","count":5760},{"topic":"Neil Patrick Harris","count":5633}]}
{"date":"2015-02-27","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":21917},{"topic":"New York","count":16012},{"topic":"United Kingdom","count":14617},{"topic":"Islamic State","count":14063},{"topic":"White House","count":8565},{"topic":"Latin America","count":7958},{"topic":"New Zealand","count":7269},{"topic":"Star Trek","count":7211},{"topic":"Associated Press","count":6825},{"topic":"Notre Dame","count":6476}]}
{"date":"2015-02-26","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":22845},{"topic":"Islamic State","count":20027},{"topic":"New York","count":17983},{"topic":"United Kingdom","count":17486},{"topic":"White House","count":8138},{"topic":"Practice Wrestling Room","count":6336},{"topic":"New Zealand","count":5734},{"topic":"North Carolina","count":5520},{"topic":"Softball Spring Practice Varsity","count":5505},{"topic":"President Barack Obama","count":5318}]}
{"date":"2015-02-19","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":20335},{"topic":"Islamic State","count":15411},{"topic":"New York","count":13131},{"topic":"United Kingdom","count":12926},{"topic":"White House","count":8622},{"topic":"Los Angeles","count":7125},{"topic":"Practice Wrestling Room","count":5810},{"topic":"Associated Press","count":5744},{"topic":"New Zealand","count":5509},{"topic":"Softball Spring Practice Varsity","count":5173}]}
{"date":"2015-02-18","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"Islamic State","count":1787},{"topic":"United States","count":1210},{"topic":"New York","count":727},{"topic":"White House","count":489},{"topic":"Los Angeles","count":424},{"topic":"Associated Press","count":385},{"topic":"New Zealand","count":353},{"topic":"United Kingdom","count":325},{"topic":"Jeb Bush","count":298},{"topic":"Practice Wrestling Room","count":280}]}
{"date":"2015-02-22","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":10495},{"topic":"Islamic State","count":8726},{"topic":"New York","count":8279},{"topic":"United Kingdom","count":6547},{"topic":"Practice Wrestling Room","count":6460},{"topic":"Softball Spring Practice Varsity","count":5700},{"topic":"Associated Press","count":4114},{"topic":"Los Angeles","count":3927},{"topic":"President Barack Obama","count":3484},{"topic":"Sydney Morning","count":3202}]}
{"date":"2015-02-21","collect_list(named_struct(NamePlaceholder(), topic, NamePlaceholder(), count))":[{"topic":"United States","count":11218},{"topic":"New York","count":8040},{"topic":"Practice Wrestling Room","count":6561},{"topic":"Islamic State","count":6545},{"topic":"Los Angeles","count":6386},{"topic":"White House","count":5853},{"topic":"Softball Spring Practice Varsity","count":5793},{"topic":"United Kingdom","count":5417},{"topic":"Sydney Morning","count":4813},{"topic":"Prime Minister","count":4619}]}
```